/****************************************************************************
 *
 * MODULE:             utils.c
 *
 * COMPONENT:          Utils interface
 *
 * REVISION:           $Revision:  0$
 *
 * DATED:              $Date: 2015-10-21 15:13:17 +0100 (Thu, 21 Oct 2015 $
 *
 * AUTHOR:             PCT
 *
 ****************************************************************************
 *
 * Copyright panchangtao@gmail.com B.V. 2015. All rights reserved
 *
 ***************************************************************************/

/****************************************************************************/
/***        Include files                                                 ***/
/****************************************************************************/
#include "utils.h"
#include <signal.h>

/****************************************************************************/
/***        Macro Definitions                                             ***/
/****************************************************************************/

/****************************************************************************/
/***        Type Definitions                                              ***/
/****************************************************************************/

/****************************************************************************/
/***        Local Function Prototypes                                     ***/
/****************************************************************************/

/****************************************************************************/
/***        Exported Variables                                            ***/
/****************************************************************************/

/****************************************************************************/
/***        Local Variables                                               ***/
/****************************************************************************/

/****************************************************************************/
/***        Exported Functions                                            ***/
/****************************************************************************/
void thread_signal_handler(int sig)
{
    DBG_vPrintf(T_TRUE, "Signal %d received\n", sig);
}

void UtilsRegisterSignalHandler()
{

    /* Set up sigmask to receive configured signal in the main thread. 
     * All created threads also get this signal mask, so all threads
     * get the signal. But we can use pthread_signal to direct it at one.
     */
    struct sigaction sa;
    sa.sa_handler = thread_signal_handler;
    sa.sa_flags = 0;
    sigemptyset(&sa.sa_mask);

    if (sigaction(THREAD_SIGNAL, &sa, NULL) == -1) 
    {
        perror("sigaction");
    }
    else
    {
        DBG_vPrintf(T_TRUE, "Signal action registered\n\r");
    }
}
/****************************************************************************/
/***        Locate   Functions                                            ***/
/****************************************************************************/

